#!amber

SHADER compute kComputeShader HLSL
AppendStructuredBuffer<float> append_buf;
void main() {
  float a = 19;
  float b = 4;

  append_buf.Append(a + b);
  append_buf.Append(a - b);
  append_buf.Append(a * b);
  append_buf.Append(a / b);
  append_buf.Append(2 * a + 7 * b);
  append_buf.Append(8 * a - 3 * b);
  append_buf.Append(5 * a - 4 * b - 9);
  append_buf.Append((3 * a + 5 * b) / 13.0f);

  bool c = a > b;
  append_buf.Append(c);
  append_buf.Append(!c);
  append_buf.Append(!c || c);
  append_buf.Append(!c && true);

  append_buf.Append(a++);
  append_buf.Append(b--);
  append_buf.Append(++a);
  append_buf.Append(a + b);

  a += 5;
  append_buf.Append(a);

  b *= 7;
  append_buf.Append(b);

  uint d = 2;
  append_buf.Append(d << 4);

  d <<= 3;
  append_buf.Append(d);

  append_buf.Append((~(d - 1)) & (15 << 2));
}
END

BUFFER kAppendBuffer DATA_TYPE float SIZE 84 FILL 0
BUFFER kAppendBufferIndex DATA_TYPE uint32 SIZE 4 FILL 0

PIPELINE compute kComputePipeline
  ATTACH kComputeShader

  BIND BUFFER kAppendBuffer AS storage DESCRIPTOR_SET 0 BINDING 0
  BIND BUFFER kAppendBufferIndex AS storage DESCRIPTOR_SET 0 BINDING 1
END

RUN kComputePipeline 1 1 1

EXPECT kAppendBuffer IDX 0 TOLERANCE 0.01% EQ 23.0 15.0  76.0 4.75  \
                                              66.0 140.0 70.0 5.923 \
                                              1.0  0.0   1.0  0.0   \
                                              19.0 4.0   21.0 24.0  \
                                              26.0 21.0  32.0 16.0  \
                                              48.0
